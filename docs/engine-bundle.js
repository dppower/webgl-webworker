!function(){"use strict";var t=function(){function t(t){this.transform_=t,this.isActive=!0}return t.prototype.update=function(t){return this.transform_.transform},t.prototype.markInactive=function(){this.isActive=!1},t}(),r=function(){function t(t,r,e){void 0===t&&(t=0),void 0===r&&(r=0),void 0===e&&(e=0),this.vector_=new Float32Array([t,r,e])}return Object.defineProperty(t.prototype,"x",{get:function(){return this.vector_[0]},set:function(t){this.vector_[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.vector_[1]},set:function(t){this.vector_[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.vector_[2]},set:function(t){this.vector_[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"array",{get:function(){return this.vector_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},enumerable:!0,configurable:!0}),t.dot=function(t,r){return t.x*r.x+t.y*r.y+t.z*r.z},t.cross=function(t,r,e){e.x=t.y*r.z-t.z*r.y,e.y=t.z*r.x-t.x*r.z,e.z=t.x*r.y-t.y*r.x},t.prototype.normalise=function(){var r=this.length;if(r>0){var e=1/r;t.scale(e,this,this)}},t.add=function(t,r,e){e.x=t.x+r.x,e.y=t.y+r.y,e.z=t.z+r.z},t.subtract=function(t,r,e){e.x=t.x-r.x,e.y=t.y-r.y,e.z=t.z-r.z},t.scale=function(t,r,e){e.x=r.x*t,e.y=r.y*t,e.z=r.z*t},t.prototype.copy=function(t){for(var r in this.vector_)this.vector_[r]=t.array[r]},t}(),e=function(){function t(t,e){void 0===t&&(t=new r),void 0===e&&(e=0);var n=e*Math.PI/360;this.v_=new r,r.scale(Math.sin(n),t,this.v_),this.w_=Math.cos(n)}return Object.defineProperty(t.prototype,"x",{get:function(){return this.v_.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.v_.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.v_.z},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this.w_},set:function(t){this.w_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"v",{get:function(){return this.v_},set:function(t){this.v_.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2)+Math.pow(this.w,2))},enumerable:!0,configurable:!0}),t.prototype.conjugate=function(){var e=new t;return r.scale(-1,this.v_,e.v),e.w=this.w_,e},t.prototype.rotate=function(r){var e=new t;return e.w=0,e.v=r,this.multiply(e).multiply(this.conjugate())},t.prototype.normalise=function(){var t=1/this.length;r.scale(t,this.v,this.v),this.w*=t},t.prototype.multiply=function(e){this.normalise(),e.normalise();var n=new t;n.w=this.w*e.w-r.dot(this.v_,e.v);var i=new r;return r.scale(e.w,this.v_,i),r.add(n.v,i,n.v),r.scale(this.w,e.v,i),r.add(n.v,i,n.v),r.cross(this.v_,e.v,i),r.add(n.v,i,n.v),n},t}(),n=function(){function t(){this.matrix_=new Float32Array(16),this.identity()}return Object.defineProperty(t.prototype,"array",{get:function(){return this.matrix_},enumerable:!0,configurable:!0}),t.prototype.identity=function(){this.matrix_[0]=1,this.matrix_[1]=0,this.matrix_[2]=0,this.matrix_[3]=0,this.matrix_[4]=0,this.matrix_[5]=1,this.matrix_[6]=0,this.matrix_[7]=0,this.matrix_[8]=0,this.matrix_[9]=0,this.matrix_[10]=1,this.matrix_[11]=0,this.matrix_[12]=0,this.matrix_[13]=0,this.matrix_[14]=0,this.matrix_[15]=1},t.multiply=function(t,r,e){for(var n=t.array[0],i=t.array[1],o=t.array[2],s=t.array[3],a=t.array[4],c=t.array[5],u=t.array[6],h=t.array[7],p=t.array[8],f=t.array[9],l=t.array[10],y=t.array[11],b=t.array[12],_=t.array[13],d=t.array[14],v=t.array[15],m=0;m<16;m+=4){var w=r.array[m],g=r.array[m+1],x=r.array[m+2],E=r.array[m+3];e.array[m]=w*n+g*a+x*p+E*b,e.array[m+1]=w*i+g*c+x*f+E*_,e.array[m+2]=w*o+g*u+x*l+E*d,e.array[m+3]=w*s+g*h+x*y+E*v}},t.prototype.rotate=function(r){var e=new t;r.normalise();var n=2*r.w*r.x,i=2*r.w*r.y,o=2*r.w*r.z,s=2*r.x*r.x,a=2*r.y*r.y,c=2*r.z*r.z,u=2*r.x*r.y,h=2*r.x*r.z,p=2*r.y*r.z;e.array[0]=1-(a+c),e.array[1]=u+o,e.array[2]=h-i,e.array[4]=u-o,e.array[5]=1-(s+c),e.array[6]=p+n,e.array[8]=h+i,e.array[9]=p-n,e.array[10]=1-(s+a),t.multiply(this,e,this)},t.prototype.scale=function(r){var e=new t;e.array[0]=r.x,e.array[5]=r.y,e.array[10]=r.z,t.multiply(this,e,this)},t.prototype.translate=function(r){var e=new t;e.array[12]=r.x,e.array[13]=r.y,e.array[14]=r.z,t.multiply(this,e,this)},t}(),i=function(){function t(t,i,o){void 0===t&&(t=new r),void 0===i&&(i=new r(1,1,1)),void 0===o&&(o=new e),this.position_=t,this.scale_=i,this.orientation_=o,this.transform_=new n}return Object.defineProperty(t.prototype,"transform",{get:function(){return this.transform_.identity(),this.transform_.rotate(this.orientation_),this.transform_.translate(this.position_),this.transform_.scale(this.scale_),this.transform_.array},enumerable:!0,configurable:!0}),t.prototype.scale=function(t){this.scale_.copy(t)},t.prototype.translate=function(t){r.add(this.position_,t,this.position_)},t.prototype.rotate=function(t,r){var n=new e(t,r),i=this.orientation_.multiply(n);this.orientation_=i},t}(),o=function(){return function(){this.aspect=1.4,this.zoom=0,this.mouseDx=0,this.mouseDy=0,this.keyDown=[],this.keyPressed=[]}}(),s=function(){function r(t,r){var e=this;this.messenger_=t,this.gameState_=r,this.current_inputs_=new o,this.inputs_subscription=this.messenger_.getInputs().subscribe(function(t){e.current_inputs_=t})}return r.prototype.Start=function(){var r=new t(new i);this.gameState_.addNewObject(r)},r.prototype.Update=function(t){var r=this.gameState_.updateObjects(t,this.current_inputs_);this.messenger_.pushChanges(r)},r.prototype.dispose=function(){this.inputs_subscription.unsubscribe()},r}(),a="undefined"!=typeof window&&window,c="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,u="undefined"!=typeof global&&global,h=a||u||c;function p(t){return"function"==typeof t}var f=Array.isArray||function(t){return t&&"number"==typeof t.length};var l,y={e:{}};function b(){try{return l.apply(this,arguments)}catch(t){return y.e=t,y}}function _(t){return l=t,b}var d=function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},v=function(t){function r(r){t.call(this),this.errors=r;var e=Error.call(this,r?r.length+" errors occurred during unsubscription:\n  "+r.map(function(t,r){return r+1+") "+t.toString()}).join("\n  "):"");this.name=e.name="UnsubscriptionError",this.stack=e.stack,this.message=e.message}return d(r,t),r}(Error),m=function(){function t(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var r;return t.prototype.unsubscribe=function(){var t,r=!1;if(!this.closed){var e=this._parent,n=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s,a=-1,c=n?n.length:0;e;)e.remove(this),e=++a<c&&n[a]||null;if(p(i))_(i).call(this)===y&&(r=!0,t=t||(y.e instanceof v?w(y.e.errors):[y.e]));if(f(o))for(a=-1,c=o.length;++a<c;){var u=o[a];if(null!=(s=u)&&"object"==typeof s)if(_(u.unsubscribe).call(u)===y){r=!0,t=t||[];var h=y.e;h instanceof v?t=t.concat(w(h.errors)):t.push(h)}}if(r)throw new v(t)}},t.prototype.add=function(r){if(!r||r===t.EMPTY)return t.EMPTY;if(r===this)return this;var e=r;switch(typeof r){case"function":e=new t(r);case"object":if(e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if("function"!=typeof e._addParent){var n=e;(e=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+r+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(e),e._addParent(this),e},t.prototype.remove=function(t){var r=this._subscriptions;if(r){var e=r.indexOf(t);-1!==e&&r.splice(e,1)}},t.prototype._addParent=function(t){var r=this._parent,e=this._parents;r&&r!==t?e?-1===e.indexOf(t)&&e.push(t):this._parents=[t]:this._parent=t},t.EMPTY=((r=new t).closed=!0,r),t}();function w(t){return t.reduce(function(t,r){return t.concat(r instanceof v?r.errors:r)},[])}var g={closed:!0,next:function(t){},error:function(t){throw t},complete:function(){}},x=h.Symbol,E="function"==typeof x&&"function"==typeof x.for?x.for("rxSubscriber"):"@@rxSubscriber",O=function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},S=function(t){function r(e,n,i){switch(t.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=g;break;case 1:if(!e){this.destination=g;break}if("object"==typeof e){e instanceof r?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new P(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new P(this,e,n,i)}}return O(r,t),r.prototype[E]=function(){return this},r.create=function(t,e,n){var i=new r(t,e,n);return i.syncErrorThrowable=!1,i},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var t=this._parent,r=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=r,this},r}(m),P=function(t){function r(r,e,n,i){var o;t.call(this),this._parentSubscriber=r;var s=this;p(e)?o=e:e&&(o=e.next,n=e.error,i=e.complete,e!==g&&(p((s=Object.create(e)).unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=n,this._complete=i}return O(r,t),r.prototype.next=function(t){if(!this.isStopped&&this._next){var r=this._parentSubscriber;r.syncErrorThrowable?this.__tryOrSetError(r,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},r.prototype.error=function(t){if(!this.isStopped){var r=this._parentSubscriber;if(this._error)r.syncErrorThrowable?(this.__tryOrSetError(r,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else{if(!r.syncErrorThrowable)throw this.unsubscribe(),t;r.syncErrorValue=t,r.syncErrorThrown=!0,this.unsubscribe()}}},r.prototype.complete=function(){var t=this;if(!this.isStopped){var r=this._parentSubscriber;if(this._complete){var e=function(){return t._complete.call(t._context)};r.syncErrorThrowable?(this.__tryOrSetError(r,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}},r.prototype.__tryOrUnsub=function(t,r){try{t.call(this._context,r)}catch(t){throw this.unsubscribe(),t}},r.prototype.__tryOrSetError=function(t,r,e){try{r.call(this._context,e)}catch(r){return t.syncErrorValue=r,t.syncErrorThrown=!0,!0}return!1},r.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},r}(S);var j=function(t){var r,e=t.Symbol;return"function"==typeof e?e.observable?r=e.observable:(r=e("observable"),e.observable=r):r="@@observable",r}(h);function M(){}var z=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(t,r,e){var n=this.operator,i=function(t,r,e){if(t){if(t instanceof S)return t;if(t[E])return t[E]()}return t||r||e?new S(t,r,e):new S(g)}(t,r,e);if(n?n.call(i,this.source):i.add(this.source||!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.syncErrorThrown=!0,t.syncErrorValue=r,t.error(r)}},t.prototype.forEach=function(t,r){var e=this;if(r||(h.Rx&&h.Rx.config&&h.Rx.config.Promise?r=h.Rx.config.Promise:h.Promise&&(r=h.Promise)),!r)throw new Error("no Promise impl found");return new r(function(r,n){var i;i=e.subscribe(function(r){if(i)try{t(r)}catch(t){n(t),i.unsubscribe()}else t(r)},n,r)})},t.prototype._subscribe=function(t){return this.source.subscribe(t)},t.prototype[j]=function(){return this},t.prototype.pipe=function(){for(var t,r=[],e=0;e<arguments.length;e++)r[e-0]=arguments[e];return 0===r.length?this:((t=r)?1===t.length?t[0]:function(r){return t.reduce(function(t,r){return r(t)},r)}:M)(this)},t.prototype.toPromise=function(t){var r=this;if(t||(h.Rx&&h.Rx.config&&h.Rx.config.Promise?t=h.Rx.config.Promise:h.Promise&&(t=h.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,e){var n;r.subscribe(function(t){return n=t},function(t){return e(t)},function(){return t(n)})})},t.create=function(r){return new t(r)},t}(),T=function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},k=function(t){function r(){var r=t.call(this,"object unsubscribed");this.name=r.name="ObjectUnsubscribedError",this.stack=r.stack,this.message=r.message}return T(r,t),r}(Error),A=function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},F=function(t){function r(r,e){t.call(this),this.subject=r,this.subscriber=e,this.closed=!1}return A(r,t),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,r=t.observers;if(this.subject=null,r&&0!==r.length&&!t.isStopped&&!t.closed){var e=r.indexOf(this.subscriber);-1!==e&&r.splice(e,1)}}},r}(m),R=function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);function n(){this.constructor=t}t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)},U=function(t){function r(r){t.call(this,r),this.destination=r}return R(r,t),r}(S),I=function(t){function r(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return R(r,t),r.prototype[E]=function(){return new U(this)},r.prototype.lift=function(t){var r=new V(this,this);return r.operator=t,r},r.prototype.next=function(t){if(this.closed)throw new k;if(!this.isStopped)for(var r=this.observers,e=r.length,n=r.slice(),i=0;i<e;i++)n[i].next(t)},r.prototype.error=function(t){if(this.closed)throw new k;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var r=this.observers,e=r.length,n=r.slice(),i=0;i<e;i++)n[i].error(t);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new k;this.isStopped=!0;for(var t=this.observers,r=t.length,e=t.slice(),n=0;n<r;n++)e[n].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},r.prototype._trySubscribe=function(r){if(this.closed)throw new k;return t.prototype._trySubscribe.call(this,r)},r.prototype._subscribe=function(t){if(this.closed)throw new k;return this.hasError?(t.error(this.thrownError),m.EMPTY):this.isStopped?(t.complete(),m.EMPTY):(this.observers.push(t),new F(this,t))},r.prototype.asObservable=function(){var t=new z;return t.source=this,t},r.create=function(t,r){return new V(t,r)},r}(z),V=function(t){function r(r,e){t.call(this),this.destination=r,this.source=e}return R(r,t),r.prototype.next=function(t){var r=this.destination;r&&r.next&&r.next(t)},r.prototype.error=function(t){var r=this.destination;r&&r.error&&this.destination.error(t)},r.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},r.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):m.EMPTY},r}(I),Y=function(){function t(){var t=this;this.input_changes_=new I,this.model_changes_=new I,this.handleMessages=function(r){t.input_changes_.next(r.data)},addEventListener("message",this.handleMessages),this.model_changes_subscription_=this.model_changes_.subscribe(function(t){postMessage(t,[t])})}return t.prototype.dispose=function(){removeEventListener("message",this.handleMessages),this.model_changes_.complete(),this.input_changes_.complete(),this.model_changes_subscription_.unsubscribe()},t.prototype.pushChanges=function(t){this.model_changes_.next(t)},t.prototype.getInputs=function(){return this.input_changes_.asObservable()},t}(),Z=function(){function t(t){this.camera_=t,this.gameObjects_=[]}return t.prototype.addNewObject=function(t){this.gameObjects_.push(t)},t.prototype.removeObject=function(t){},t.prototype.updateObjects=function(t,r){var e=16*(this.gameObjects_.length+2)*4,n=new ArrayBuffer(e),i=new Float32Array(n,0,16),o=new Float32Array(n,64,16);return this.camera_.update(r.zoom,r.aspect),i.set(this.camera_.view),o.set(this.camera_.projection),this.gameObjects_.forEach(function(r,e,i){new Float32Array(n,64*(e+2),16).set(r.update(t))}),n},t}(),D=function(){function t(){this.minZoom=-3,this.maxZoom=-4,this.zoomSpeed=.2,this.near_=.1,this.far_=100,this.pMatrix_=new Float32Array(16),this.vMatrix_=new Float32Array(16),this.vFieldOfView_=60*Math.PI/180,this.transform_=new i;var t=new r(0,0,-3.5);this.transform_.translate(t),this.vMatrix_=this.transform_.transform}return Object.defineProperty(t.prototype,"view",{get:function(){return this.vMatrix_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projection",{get:function(){return this.calculateFrustrum(),this.pMatrix_},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e){var n=t*this.zoomSpeed,i=this.vMatrix_[14];n=n+i<=this.minZoom?0:n+i>=this.maxZoom?0:n;var o=new r(0,0,n);this.transform_.translate(o),this.vMatrix_=this.transform_.transform,this.aspect_=e},t.prototype.calculateFrustrum=function(){var t=Math.tan(.5*(Math.PI-this.vFieldOfView_)),r=1/(this.near_-this.far_);this.pMatrix_[0]=t/this.aspect_,this.pMatrix_[5]=t,this.pMatrix_[10]=(this.near_+this.far_)*r,this.pMatrix_[11]=-1,this.pMatrix_[14]=this.near_*this.far_*2*r},t}(),q=new s(new Y,new Z(new D));!function(){q.Start();var t=function(){setInterval(t,1e3/60),q.Update(1e3/60)};t()}()}();
//# sourceMappingURL=engine-bundle.js.map
